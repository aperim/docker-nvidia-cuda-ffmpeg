#!/usr/bin/env bash
set -e

if [[ -z "${UID}" ]]; then
  UID=1000
else
  usermod -u ${UID} ffmpeg
fi

if [[ -z "${GID}" ]]; then
  GID=1000
else
  groupmod -g ${GID} ffmpeg
fi

chown -R ${UID}:${GID} /etc/ffmpeg

if [[ -x "/usr/bin/ffmpeg" ]]; then
  echo >&2 "ğŸ†— Ready"
  # first arg is `-f` or `--some-option`
  if [ "${1#-}" != "$1" ]; then
    echo >&2 "ğŸ“º Starting ffmpeg with settings \"$@\""
    sudo --preserve-env -H -u ffmpeg -- "/usr/bin/ffmpeg" "$@"
  else
    echo >&2 "ğŸ“º Executing \"$@\""
    sudo --preserve-env -H -u ffmpeg -- bash -c "$@" 
  fi
else
  echo >&2 "ğŸ›‘ No ffmpeg executable"
fi